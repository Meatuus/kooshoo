(function(B,D,E){D.infinitescroll=function H(b,e,f){this.element=D(f);if(!this._create(b,e)){this.failed=true}};D.infinitescroll.defaults={loading:{finished:E,finishedMsg:"<em>Congratulations, you've reached the end of the internet.</em>",img:"http://www.infinite-scroll.com/loading.gif",msg:null,msgText:"<em>Loading the next set of posts...</em>",selector:null,speed:"fast",start:E},state:{isDuringAjax:false,isInvalidPage:false,isDestroyed:false,isDone:false,isPaused:false,currPage:1},callback:E,debug:false,behavior:E,binder:D(B),nextSelector:"div.navigation a:first",navSelector:"div.navigation",contentSelector:null,extraScrollPx:150,itemSelector:"div.post",animate:false,pathParse:E,dataType:"html",appendCallback:true,bufferPx:40,errorCallback:function(){},infid:0,pixelsFromNavToBottom:E,path:E};D.infinitescroll.prototype={_binding:function I(c){var e=this,f=e.options;f.v="2.0b2.111027";if(!!f.behavior&&this["_binding_"+f.behavior]!==E){this["_binding_"+f.behavior].call(this);return}if(c!=="bind"&&c!=="unbind"){this._debug("Binding value  "+c+" not valid");return false}if(c=="unbind"){this.options.binder.unbind("smartscroll.infscr."+e.options.infid)}else{this.options.binder[c]("smartscroll.infscr."+e.options.infid,function(){e.scroll()})}this._debug("Binding",c)},_create:function J(b,c){var g=D.extend(true,{},D.infinitescroll.defaults,b);if(!this._validate(b)){return false}this.options=g;var h=D(g.nextSelector).attr("href");if(!h){this._debug("Navigation selector not found");return false}g.path=this._determinepath(h);g.contentSelector=g.contentSelector||this.element;g.loading.selector=g.loading.selector||g.contentSelector;g.loading.msg=D('<div id="infscr-loading"><img alt="Loading..." src="'+g.loading.img+'" /><div>'+g.loading.msgText+"</div></div>");(new Image).src=g.loading.img;g.pixelsFromNavToBottom=D(document).height()-D(g.navSelector).offset().top;g.loading.start=g.loading.start||function(){D(g.navSelector).hide();g.loading.msg.appendTo(g.loading.selector).show(g.loading.speed,function(){beginAjax(g)})};g.loading.finished=g.loading.finished||function(){g.loading.msg.fadeOut("normal")};g.callback=function(d,e){if(!!g.behavior&&d["_callback_"+g.behavior]!==E){d["_callback_"+g.behavior].call(D(g.contentSelector)[0],e)}if(c){c.call(D(g.contentSelector)[0],e,g)}};this._setup();return true},_debug:function K(){if(this.options&&this.options.debug){return B.console&&console.log.call(console,arguments)}},_determinepath:function L(c){var d=this.options;if(!!d.behavior&&this["_determinepath_"+d.behavior]!==E){this["_determinepath_"+d.behavior].call(this,c);return}if(!!d.pathParse){this._debug("pathParse manual");return d.pathParse(c,this.options.state.currPage+1)}else{if(c.match(/^(.*?)\b2\b(.*?$)/)){c=c.match(/^(.*?)\b2\b(.*?$)/).slice(1)}else{if(c.match(/^(.*?)2(.*?$)/)){if(c.match(/^(.*?page=)2(\/.*|$)/)){c=c.match(/^(.*?page=)2(\/.*|$)/).slice(1);return c}c=c.match(/^(.*?)2(.*?$)/).slice(1)}else{if(c.match(/^(.*?page=)1(\/.*|$)/)){c=c.match(/^(.*?page=)1(\/.*|$)/).slice(1);return c}else{this._debug("Sorry, we couldn't parse your Next (Previous Posts) URL. Verify your the css selector points to the correct A tag. If you still get this error: yell, scream, and kindly ask for help at infinite-scroll.com.");d.state.isInvalidPage=true}}}}this._debug("determinePath",c);return c},_error:function M(c){var d=this.options;if(!!d.behavior&&this["_error_"+d.behavior]!==E){this["_error_"+d.behavior].call(this,c);return}if(c!=="destroy"&&c!=="end"){c="unknown"}this._debug("Error",c);if(c=="end"){this._showdonemsg()}d.state.isDone=true;d.state.currPage=1;d.state.isPaused=false;this._binding("unbind")},_loadcallback:function N(a,b){var c=this.options,l=this.options.callback,m=c.state.isDone?"done":!c.appendCallback?"no-append":"append",n;if(!!c.behavior&&this["_loadcallback_"+c.behavior]!==E){this["_loadcallback_"+c.behavior].call(this,a,b);return}switch(m){case"done":this._showdonemsg();return false;break;case"no-append":if(c.dataType=="html"){b="<div>"+b+"</div>";b=D(b).find(c.itemSelector)}break;case"append":var o=a.children();if(o.length==0){return this._error("end")}n=document.createDocumentFragment();while(a[0].firstChild){n.appendChild(a[0].firstChild)}this._debug("contentSelector",D(c.contentSelector)[0]);D(c.contentSelector)[0].appendChild(n);b=o.get();break}c.loading.finished.call(D(c.contentSelector)[0],c);if(c.animate){var p=D(B).scrollTop()+D("#infscr-loading").height()+c.extraScrollPx+"px";D("html,body").animate({scrollTop:p},800,function(){c.state.isDuringAjax=false})}if(!c.animate){c.state.isDuringAjax=false}l(this,b)},_nearbottom:function O(){var a=this.options,b=0+D(document).height()-a.binder.scrollTop()-D(B).height();if(!!a.behavior&&this["_nearbottom_"+a.behavior]!==E){return this["_nearbottom_"+a.behavior].call(this)}this._debug("math:",b,a.pixelsFromNavToBottom);return b-a.bufferPx<a.pixelsFromNavToBottom},_pausing:function P(c){var d=this.options;if(!!d.behavior&&this["_pausing_"+d.behavior]!==E){this["_pausing_"+d.behavior].call(this,c);return}if(c!=="pause"&&c!=="resume"&&c!==null){this._debug("Invalid argument. Toggling pause value instead")}c=c&&(c=="pause"||c=="resume")?c:"toggle";switch(c){case"pause":d.state.isPaused=true;break;case"resume":d.state.isPaused=false;break;case"toggle":d.state.isPaused=!d.state.isPaused;break}this._debug("Paused",d.state.isPaused);return false},_setup:function Q(){var b=this.options;if(!!b.behavior&&this["_setup_"+b.behavior]!==E){this["_setup_"+b.behavior].call(this);return}this._binding("bind");return false},_showdonemsg:function R(){var b=this.options;if(!!b.behavior&&this["_showdonemsg_"+b.behavior]!==E){this["_showdonemsg_"+b.behavior].call(this);return}b.loading.msg.find("img").hide().parent().find("div").html(b.loading.finishedMsg).animate({opacity:1},2000,function(){D(this).parent().fadeOut("normal")});b.errorCallback.call(D(b.contentSelector)[0],"done")},_validate:function S(b){for(var d in b){if(d.indexOf&&d.indexOf("Selector")>-1&&D(b[d]).length===0){this._debug("Your "+d+" found no elements.");return false}}return true},bind:function T(){this._binding("bind")},destroy:function U(){this.options.state.isDestroyed=true;return this._error("destroy")},pause:function V(){this._pausing("pause")},resume:function W(){this._pausing("resume")},retrieve:function X(b){var c=this,n=c.options,o=n.path,p,q,r,s,t,b=b||null,u=!!b?b:n.state.currPage;beginAjax=function v(d){d.state.currPage++;c._debug("heading into ajax",o);p=D(d.contentSelector).is("table")?D("<tbody/>"):D("<div/>");r=o.join(d.state.currPage);s=d.dataType=="html"||d.dataType=="json"?d.dataType:"html+callback";if(d.appendCallback&&d.dataType=="html"){s+="+callback"}switch(s){case"html+callback":c._debug("Using HTML via .load() method");p.load(r+" "+d.itemSelector,null,function f(e){c._loadcallback(p,e)});break;case"html":case"json":c._debug("Using "+s.toUpperCase()+" via $.ajax() method");D.ajax({url:r,dataType:d.dataType,complete:function g(e,h){t=typeof e.isResolved!=="undefined"?e.isResolved():h==="success"||h==="notmodified";t?c._loadcallback(p,e.responseText):c._error("end")}});break}};if(!!n.behavior&&this["retrieve_"+n.behavior]!==E){this["retrieve_"+n.behavior].call(this,b);return}if(n.state.isDestroyed){this._debug("Instance is destroyed");return false}n.state.isDuringAjax=true;n.loading.start.call(D(n.contentSelector)[0],n)},scroll:function Y(){var c=this.options,d=c.state;if(!!c.behavior&&this["scroll_"+c.behavior]!==E){this["scroll_"+c.behavior].call(this);return}if(d.isDuringAjax||d.isInvalidPage||d.isDone||d.isDestroyed||d.isPaused){return}if(!this._nearbottom()){return}this.retrieve()},toggle:function Z(){this._pausing()},unbind:function aa(){this._binding("unbind")},update:function ab(b){if(D.isPlainObject(b)){this.options=D.extend(true,this.options,b)}}};D.fn.infinitescroll=function C(b,f){var g=typeof b;switch(g){case"string":var h=Array.prototype.slice.call(arguments,1);this.each(function(){var a=D.data(this,"infinitescroll");if(!a){return false}if(!D.isFunction(a[b])||b.charAt(0)==="_"){return false}a[b].apply(a,h)});break;case"object":this.each(function(){var a=D.data(this,"infinitescroll");if(a){a.update(b)}else{a=new D.infinitescroll(b,f,this);if(!a.failed){D.data(this,"infinitescroll",a)}}});break}return this};var F=D.event,G;F.special.smartscroll={setup:function(){D(this).bind("scroll",F.special.smartscroll.handler)},teardown:function(){D(this).unbind("scroll",F.special.smartscroll.handler)},handler:function(b,e){var g=this,h=arguments;b.type="smartscroll";if(G){clearTimeout(G)}G=setTimeout(function(){D.event.handle.apply(g,h)},e==="execAsap"?0:100)}};D.fn.smartscroll=function(b){return b?this.bind("smartscroll",b):this.trigger("smartscroll",["execAsap"])}})(window,jQuery);